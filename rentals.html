<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rentals | ApnaBridge</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat;
      color: #fff;
      margin: 0;
    }

    /* Navbar */
    header {
      background: rgba(0, 119, 182, 0.95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 50px;
      height: 70px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .logo img { height: 125px; width: auto; }
    .logo span { color: #ffdd00; font-weight: bold; font-size: 22px; }

    .header-buttons { display: flex; gap: 10px; }
    button {
      background: #ffdd00;
      color: #000;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
    }

    main {
      background: rgba(0,0,0,0.6);
      margin: 60px auto;
      width: 85%;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
    }

    .rental-card {
      background: #fff;
      color: #333;
      padding: 20px;
      border-radius: 8px;
      margin: 15px 0;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .rental-card:hover { transform: translateY(-3px); }

    /* üî• Trending Section Styles */
    .trending {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
    }
    .trending h2 {
      color: #ffdd00;
      text-align: center;
      margin-bottom: 10px;
    }
    .trending ul {
      list-style: none;
      padding: 0;
      text-align: center;
    }
    .trending li { margin: 8px 0; }
    .trending a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
    }
    .trending a:hover {
      color: #ffdd00;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo" onclick="window.location.href='index.html'">
      <img src="apnabridge.png" alt="ApnaBridge Logo">
      <span></span>
    </div>
    <div class="header-buttons">
      <button onclick="window.location.href='index.html'">üè† Home</button>
      <button onclick="window.location.href='add-rental.html'">+ Add Rental</button>
    </div>
  </header>

  <main>
    <h2>Available Rentals</h2>
    <div id="rentalsContainer"></div>

    <!-- üî• Trending Section -->
    <section class="trending">
      <h2>üî• Trending Rentals</h2>
      <ul id="trendingList"></ul>
    </section>
  </main>

  <script>
    async function fetchRentals() {
      try {
        const res = await fetch("http://127.0.0.1:5000/rentals");
        if (!res.ok) throw new Error("Failed to load rentals");
        const rentals = await res.json();
        const container = document.getElementById("rentalsContainer");
        container.innerHTML = "";

        rentals.forEach(rental => {
          const shortDesc = (rental.description || "").substring(0, 200);
          container.innerHTML += `
            <div class="rental-card" onclick="viewRental(${rental.id})" role="button" tabindex="0">
              <h3>${escapeHtml(rental.title)}</h3>
              <p>${escapeHtml(rental.location)} | ‚Çπ${escapeHtml(String(rental.price || '0'))}</p>
              <p>${escapeHtml(shortDesc)}${(rental.description && rental.description.length>200) ? '...' : ''}</p>
            </div>
          `;
        });
      } catch (err) {
        console.error(err);
        document.getElementById("rentalsContainer").innerHTML =
          "<p style='color:#ffd700'>Failed to load rentals. Try again later.</p>";
      }
    }

    function viewRental(id) {
      window.location.href = `rental_details.html?id=${encodeURIComponent(id)}`;
    }

    async function fetchTrending() {
      try {
        const res = await fetch("http://127.0.0.1:5000/trending_rentals");
        if (!res.ok) throw new Error("Failed to load trending rentals");
        const trending = await res.json();
        const list = document.getElementById("trendingList");
        list.innerHTML = trending.length ? trending.map(item => `
          <li><a href="rental_details.html?id=${encodeURIComponent(item.id)}">${escapeHtml(item.title)} - ‚Çπ${escapeHtml(String(item.price || '0'))}</a></li>`
        ).join("") : "<li>No trending rentals</li>";
      } catch (err) {
        console.error(err);
      }
    }

    function escapeHtml(str){
      return str ? String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;") : "";
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchRentals();
      fetchTrending();
    });
  </script>
</body>
</html>








